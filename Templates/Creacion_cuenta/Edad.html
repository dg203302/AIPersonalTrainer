<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="/Scripts/ui_transparencia_apply.js"></script>
    <link rel="stylesheet" href="/Styles/styles_sele_edad.css">
    <meta name="theme-color" content="#0A1226">
    <title>Edad</title>
</head>
<body>
    <header>
        <h1>Comencemos</h1>
    </header>
    <main>
        <form id="form_ingreso_edad">
            <div id="selector_edad">
                <label>Fecha de nacimiento</label>

				<p class="helper">Usamos tu fecha de nacimiento para ajustar mejor las recomendaciones: intensidad, volumen y ritmo de progreso. La idea es que el plan sea exigente, pero realista y seguro.</p>

                <div class="wheel-row" role="group" aria-label="Fecha de nacimiento">
                    <div class="wheel" data-field="dia" aria-label="Día" tabindex="0"></div>
                    <div class="wheel" data-field="mes" aria-label="Mes" tabindex="0"></div>
                    <div class="wheel" data-field="ano" aria-label="Año" tabindex="0"></div>
                </div>

                <!-- Hidden inputs used by submit handler -->
                <input type="hidden" id="dia" name="dia" required>
                <input type="hidden" id="mes" name="mes" required>
                <input type="hidden" id="ano" name="ano" required>
            </div>

            <button type="submit">Siguiente</button>
        </form>

        <section class="page-copy" aria-label="Información adicional">
            <h2>¿Por qué te lo pedimos?</h2>
            <p>Un plan de entrenamiento se vuelve mucho más útil cuando tiene contexto. No es lo mismo empezar de cero que retomar después de un tiempo, y no es lo mismo entrenar “para moverse mejor” que entrenar “para progresar fuerte”. Esta app intenta encontrar un equilibrio: simple de usar, pero con estructura.</p>
            <p>Además, buscamos que las elecciones de ejercicios tengan sentido: movimientos principales para construir base, complementarios para sumar trabajo y accesorios para reforzar puntos débiles. Sin rutinas eternas, sin vueltas.</p>
            <div class="note">
                <h3>Privacidad</h3>
                <p>Tu información se usa solo para el funcionamiento de la experiencia. La prioridad es mantener todo transparente y evitar datos innecesarios.</p>
            </div>
        </section>
    </main>
    <footer>
        <a href="/index.html"><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9ImN1cnJlbnRDb2xvciIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGNsYXNzPSJsdWNpZGUgbHVjaWRlLWhvdXNlLWljb24gbHVjaWRlLWhvdXNlIj48cGF0aCBkPSJNMTUgMjF2LThhMSAxIDAgMCAwLTEtMWgtNGExIDEgMCAwIDAtMSAxdjgiLz48cGF0aCBkPSJNMyAxMGEyIDIgMCAwIDEgLjcwOS0xLjUyOGw3LTZhMiAyIDAgMCAxIDIuNTgyIDBsNyA2QTIgMiAwIDAgMSAyMSAxMHY5YTIgMiAwIDAgMS0yIDJINWEyIDIgMCAwIDEtMi0yeiIvPjwvc3ZnPg==" alt="home"></a>
    </footer>

    <script type="module">
        import dayjs from "https://esm.sh/dayjs@1";

        const updateFixedChromeHeights = () => {
            const header = document.querySelector("header");
            const footer = document.querySelector("footer");
            const root = document.documentElement;

            if (header) root.style.setProperty("--header-fixed", `${header.offsetHeight}px`);
            if (footer) root.style.setProperty("--footer-fixed", `${footer.offsetHeight}px`);
        };

        const initFixedChromeObservers = () => {
            updateFixedChromeHeights();

            if ("ResizeObserver" in window) {
                const ro = new ResizeObserver(() => updateFixedChromeHeights());
                const header = document.querySelector("header");
                const footer = document.querySelector("footer");
                if (header) ro.observe(header);
                if (footer) ro.observe(footer);
            } else {
                window.addEventListener("resize", updateFixedChromeHeights, { passive: true });
            }
        };

        const WHEEL_ITEM_HEIGHT = 44;
        const pad2 = (value) => String(value).padStart(2, "0");

        const buildWheel = ({ field, values, format }) => {
            const wheelEl = document.querySelector(`.wheel[data-field="${field}"]`);
            const inputEl = document.getElementById(field);
            if (!wheelEl || !inputEl) return;

            wheelEl.innerHTML = "";
            wheelEl.dataset.index = "0";
            wheelEl.dataset.length = String(values.length);

            const frag = document.createDocumentFragment();
            for (let i = 0; i < values.length; i++) {
                const item = document.createElement("div");
                item.className = "wheel-item";
                item.dataset.value = String(values[i]);
                item.textContent = format ? format(values[i]) : String(values[i]);
                frag.appendChild(item);
            }
            wheelEl.appendChild(frag);

            const setActive = (index) => {
                const clamped = Math.max(0, Math.min(values.length - 1, index));
                wheelEl.dataset.index = String(clamped);
                inputEl.value = String(values[clamped]);
                const items = wheelEl.querySelectorAll(".wheel-item");
                items.forEach((node, idx) => node.classList.toggle("is-active", idx === clamped));
            };

            let scrollTimer = null;
            const onScroll = () => {
                const idx = Math.round((wheelEl.scrollTop + 0.0001) / WHEEL_ITEM_HEIGHT);
                setActive(idx);
                if (scrollTimer) window.clearTimeout(scrollTimer);
                scrollTimer = window.setTimeout(() => {
                    wheelEl.scrollTo({ top: Number(wheelEl.dataset.index) * WHEEL_ITEM_HEIGHT, behavior: "smooth" });
                }, 80);
            };

            wheelEl.addEventListener("scroll", onScroll, { passive: true });
            wheelEl.addEventListener("click", (e) => {
                const item = e.target.closest(".wheel-item");
                if (!item) return;
                const items = Array.from(wheelEl.querySelectorAll(".wheel-item"));
                const idx = items.indexOf(item);
                setActive(idx);
                wheelEl.scrollTo({ top: idx * WHEEL_ITEM_HEIGHT, behavior: "smooth" });
            });

            wheelEl.addEventListener("keydown", (e) => {
                if (e.key !== "ArrowUp" && e.key !== "ArrowDown") return;
                e.preventDefault();
                const delta = e.key === "ArrowDown" ? 1 : -1;
                const idx = Number(wheelEl.dataset.index || "0") + delta;
                setActive(idx);
                wheelEl.scrollTo({ top: Number(wheelEl.dataset.index) * WHEEL_ITEM_HEIGHT, behavior: "smooth" });
            });

            // Initialize
            setActive(0);
            wheelEl.scrollTop = 0;
        };

        const isValidYMD = (year, month, day) => {
            if (!Number.isInteger(year) || !Number.isInteger(month) || !Number.isInteger(day)) return false;
            if (month < 1 || month > 12) return false;
            if (day < 1 || day > 31) return false;
            const d = new Date(year, month - 1, day);
            return d.getFullYear() === year && d.getMonth() === month - 1 && d.getDate() === day;
        };

        const initWheels = () => {
            const years = [];
            for (let y = 2032; y >= 1900; y--) years.push(y);

            buildWheel({ field: "dia", values: Array.from({ length: 31 }, (_, i) => i + 1), format: pad2 });
            buildWheel({ field: "mes", values: Array.from({ length: 12 }, (_, i) => i + 1), format: pad2 });
            buildWheel({ field: "ano", values: years, format: (y) => String(y) });

            // sensible defaults (01/01/2000)
            const dayWheel = document.querySelector('.wheel[data-field="dia"]');
            const monthWheel = document.querySelector('.wheel[data-field="mes"]');
            const yearWheel = document.querySelector('.wheel[data-field="ano"]');
            const yearsLen = yearWheel ? Number(yearWheel.dataset.length || "0") : 0;
            const index2000 = Math.max(0, Math.min(yearsLen - 1, (2032 - 2000)));

            if (dayWheel) {
                dayWheel.scrollTo({ top: 0, behavior: "auto" });
                dayWheel.dispatchEvent(new Event("scroll"));
            }
            if (monthWheel) {
                monthWheel.scrollTo({ top: 0, behavior: "auto" });
                monthWheel.dispatchEvent(new Event("scroll"));
            }
            if (yearWheel) {
                yearWheel.scrollTo({ top: index2000 * WHEEL_ITEM_HEIGHT, behavior: "auto" });
                yearWheel.dispatchEvent(new Event("scroll"));
            }

            // Ensure hidden inputs are set even if scroll events are blocked
            document.getElementById("dia").value ||= "1";
            document.getElementById("mes").value ||= "1";
            document.getElementById("ano").value ||= "2000";
            updateFixedChromeHeights();
        };

        if (document.readyState === "loading") {
            document.addEventListener("DOMContentLoaded", () => { initFixedChromeObservers(); initWheels(); }, { once: true });
        } else {
            initFixedChromeObservers();
            initWheels();
        }

        document.getElementById("form_ingreso_edad").addEventListener("submit", function (event) {
            event.preventDefault();

            const dia = parseInt(document.getElementById("dia").value, 10);
            const mes = parseInt(document.getElementById("mes").value, 10);
            const ano = parseInt(document.getElementById("ano").value, 10);

            if (!isValidYMD(ano, mes, dia)) {
                alert("Fecha de nacimiento inválida");
                return;
            }

            const nacimiento = dayjs(`${ano}-${mes}-${dia}`);
            const hoy = dayjs();

            const edad = hoy.diff(nacimiento, "year");
            sessionStorage.setItem("edad_temp", String(edad));
            return window.location.href = "/Templates/Creacion_cuenta/Seleccion_Altura.html";
        });
    </script>
</body>
</html>